!function(e){function t(t){for(var r,i,s=t[0],u=t[1],c=t[2],d=0,m=[];d<s.length;d++)i=s[d],o[i]&&m.push(o[i][0]),o[i]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(l&&l(t);m.length;)m.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var u=n[s];0!==o[u]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={0:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var s=window.webpackJsonp=window.webpackJsonp||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var l=u;a.push([115,1]),n()}({109:function(e,t,n){},112:function(e,t){var n,r,o,a,i,s;window.neuraldaw=window.neuraldaw||{},n=window.neuraldaw,o=[(r={MLDY:0,BASS:1,KICK:2,SNAR:3,CHAT:4,OHAT:5,LTOM:6,MTOM:7,HTOM:8,CRSH:9,RIDE:10}).MLDY,r.BASS],a=[r.KICK,r.SNAR,r.CHAT,r.OHAT,r.LTOM,r.MTOM,r.HTOM,r.CRSH,r.RIDE],i=[r.MLDY,r.BASS,r.KICK,r.SNAR,r.CHAT,r.OHAT,r.LTOM,r.MTOM,r.HTOM,r.CRSH,r.RIDE],s={36:r.KICK,38:r.SNAR,42:r.CHAT,46:r.OHAT,45:r.LTOM,48:r.MTOM,50:r.HTOM,49:r.CRSH,51:r.RIDE},n.constants={},n.constants.Instruments=r,n.constants.AllInstruments=i,n.constants.ToneInstruments=o,n.constants.DrumInstruments=a,n.constants.MidiPitchToDrumInstrument=s},115:function(e,t,n){"use strict";n.r(t);n(50),n(89),n(90),n(31),n(12),n(21),n(48),n(74),n(49),n(22);var r=n(84),o=n.n(r),a=(n(109),n(77),n(80),n(81),n(33)),i=n.n(a),s=["rgba(53, 53, 53, 1)","rgba(60, 110, 113, 1)","rgba(255, 255, 255, 1)","rgba(217, 217, 217, 1)","rgba(40, 75, 99, 1)","rgba(80, 80, 80, 1)","#fd90a0"];function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.nd=n,this.notes=[],this.ui={},this.loading=!0,this.waiting=!1,this.hoveringSounds=Array(9).fill(!1),this.hoveringNotes=Array(9).fill(!0)}var t,n,r;return t=e,(n=[{key:"updateNotes",value:function(e){this.loading=!1,this.notes=e}},{key:"draw",value:function(e){this.canvas=document.getElementById(this.id);var t=i()(this.canvas);this.canvas.width=0|t[0],this.canvas.height=0|t[1];var n=this.canvas.width,r=this.canvas.height,o=n-10,a=this.canvas.getContext("2d");a.save(),a.clearRect(0,0,n,r),a.translate(5,2.5),a.save();for(var u=o/64,c=r/9,l=0;l<9;l+=1)if(this.hoveringNotes[l]){for(var d=0;d<64;d+=1)if(d%4==0){if(a.save(),a.fillStyle=s[6],a.translate(d*u,(l+.25)*c),Math.random()>.98){a.fillRect(0,0,.8*u,.8*u)}else a.translate(.3*u,.3*u),a.fillRect(0,0,.3*u,.3*u);a.restore()}}else if(this.hoveringSounds[l]){for(var m=0;m<64;m+=1)if(m%4==0){a.save(),a.fillStyle=s[6],a.translate(m*u,(l+.25)*c);var f=new Date;a.translate(0,Math.sin(.005*f+.2*m+.4*l)*c*.1);a.fillRect(0,0,.3*u,.3*u),a.restore()}}else for(var p=0;p<64;p+=1)p%4==0&&(a.save(),a.fillStyle=s[5],a.translate(p*u,(l+.25)*c),a.translate(.3*u,.3*u),a.fillRect(0,0,.3*u,.3*u),a.restore());if(!this.loading){var h=!0,g=!1,v=void 0;try{for(var w,y=this.notes[Symbol.iterator]();!(h=(w=y.next()).done);h=!0){var b=w.value,S=b.pitch,R=b.quantizedStartStep,x=(b.quantizedEndStep,this.nd.constants.MidiPitchToDrumInstrument[S]-2);a.save(),a.translate(R*u,(8-x+.25)*c),this.waiting?a.fillStyle=s[5]:a.fillStyle=s[3],R===e?(a.fillStyle=s[6],a.translate(-.3*u,-.3*u),a.fillRect(0,0,1.5*u,1.5*u)):a.fillRect(0,0,.9*u,.9*u),a.restore()}}catch(e){g=!0,v=e}finally{try{h||null==y.return||y.return()}finally{if(g)throw v}}}a.restore(),a.restore()}}])&&u(t.prototype,n),r&&u(t,r),e}();function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.melody=[],this.loading=!0,this.currentPosition=0,this.canvas=document.getElementById(this.id),this.hoveringNotes=!0,this.hoveringSounds=!1,this.waiting=!1}var t,n,r;return t=e,(n=[{key:"updateMelody",value:function(e){this.loading=!1,this.melody=e}},{key:"draw",value:function(e){this.canvas=document.getElementById(this.id);var t=i()(this.canvas);this.canvas.width=0|t[0],this.canvas.height=0|t[1];var n=this.canvas.width,r=this.canvas.height,o=n-10,a=r-10,u=this.canvas.getContext("2d");if(u.save(),u.clearRect(0,0,n,r),u.translate(5,5),this.drawAnchorPoints(u,o,a,o/16),!this.loading){u.save();var c=o/64,l=a/64,d=!0,m=!1,f=void 0;try{for(var p,h=this.melody[Symbol.iterator]();!(d=(p=h.next()).done);d=!0){var g=p.value,v=g.pitch,w=g.quantizedStartStep,y=g.quantizedEndStep,b=y-w;u.save(),u.translate(w*c,(64-(v-28))*l),this.waiting?u.fillStyle=s[5]:u.fillStyle=s[3],e>=w&&e<y?(u.fillStyle=s[6],u.translate(-b*c*.1,-2.5),u.fillRect(0,0,b*c*1.1,10)):u.fillRect(0,0,b*c*.9,5),u.restore()}}catch(e){m=!0,f=e}finally{try{d||null==h.return||h.return()}finally{if(m)throw f}}u.restore()}u.restore()}},{key:"drawAnchorPoints",value:function(e,t,n,r){e.save();for(var o=t/r,a=n/r,i=0;i<=o;i+=1)for(var u=0;u<=a+1;u+=1){if(e.save(),e.fillStyle=s[5],e.translate(i*r,u*r),this.hoveringSounds){e.fillStyle=s[6];var c=new Date;e.translate(0,Math.sin(.005*c+.3*i+.3*u)*a*.5),e.fillRect(0,0,2,2)}else this.hoveringNotes?(e.fillStyle=s[6],Math.random()>.98?(e.translate(-3,-3),e.fillRect(0,0,6,6)):e.fillRect(0,0,2,2)):e.fillRect(0,0,2,2);e.restore()}e.restore()}}])&&l(t.prototype,n),r&&l(t,r),e}();n(112),n(113),n(82),n(114);function m(e,t,n,r,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function f(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){m(a,r,o,i,s,"next",e)}function s(e){m(a,r,o,i,s,"throw",e)}i(void 0)})}}function p(e,t,n,r,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function h(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){p(a,r,o,i,s,"next",e)}function s(e){p(a,r,o,i,s,"throw",e)}i(void 0)})}}window.drumgan=window.drumgan||{},function(e,t){var n=function(e){this.initialized=!1,this.checkpointURI=e};n.prototype.initialize=f(regeneratorRuntime.mark(function t(){var n,r=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.initialized&&this.dispose(),void 0!==this.checkpointURI){t.next=3;break}throw new Error("Need to specify checkpoint URI");case 3:return t.next=5,fetch("".concat(this.checkpointURI,"/weights_manifest.json")).then(function(e){return e.json()}).then(function(t){return e.io.loadWeights(t,r.checkpointURI)});case 5:n=t.sent,this.modelVars=n,this.initialized=!0;case 8:case"end":return t.stop()}},t,this)})),n.prototype.sampleLatentVector=function(){var t=f(regeneratorRuntime.mark(function t(n,r){var o,a,i,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.randomUniform([n,50],-1,1,"float32",r),t.next=3,o.data();case 3:for(a=t.sent,o.dispose(),i=[],s=0;s<n;++s)i.push(a.slice(50*s,50*(s+1)));return t.abrupt("return",i);case 8:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}();var r=function(t,n,r){var o=t.shape[0],a=t.shape[1],i=n.shape[2];return t=e.expandDims(t,1),t=e.conv2dTranspose(t,n,[o,1,a*r,i],[1,r],"same"),t=e.squeeze(t,1)};n.prototype.generate=function(){var t=f(regeneratorRuntime.mark(function t(n,o){var a,i,s,u,c,l=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o.length===n.length){t.next=2;break}throw new Error("Array of latent vectors must be same length as array of drum IDs");case 2:return a=o.length,i=e.tidy(function(){var t=e.tensor2d(o,[a,50],"float32"),i=e.tensor1d(n,"int32"),s=e.oneHot(i,8),u=e.concat([s,t],1);return u=e.matMul(u,l.modelVars["G/z_project/dense/kernel"]),u=e.add(u,l.modelVars["G/z_project/dense/bias"]),u=e.relu(u),u=e.reshape(u,[a,16,-1]),u=r(u,l.modelVars["G/upconv_0/conv2d_transpose/kernel"],4),u=e.add(u,l.modelVars["G/upconv_0/conv2d_transpose/bias"]),u=e.relu(u),u=r(u,l.modelVars["G/upconv_1/conv2d_transpose/kernel"],4),u=e.add(u,l.modelVars["G/upconv_1/conv2d_transpose/bias"]),u=e.relu(u),u=r(u,l.modelVars["G/upconv_2/conv2d_transpose/kernel"],4),u=e.add(u,l.modelVars["G/upconv_2/conv2d_transpose/bias"]),u=e.relu(u),u=r(u,l.modelVars["G/upconv_3/conv2d_transpose/kernel"],4),u=e.add(u,l.modelVars["G/upconv_3/conv2d_transpose/bias"]),u=e.relu(u),u=r(u,l.modelVars["G/upconv_4/conv2d_transpose/kernel"],4),u=e.add(u,l.modelVars["G/upconv_4/conv2d_transpose/bias"]),u=e.relu(u),u=r(u,l.modelVars["G/upconv_5/conv2d_transpose/kernel"],2),u=e.add(u,l.modelVars["G/upconv_5/conv2d_transpose/bias"]),u=e.tanh(u),u=e.conv1d(u,l.modelVars["G/pp_filt/conv1d/kernel"],1,"same")}),t.next=6,i.data();case 6:for(s=t.sent,i.dispose(),u=[],c=0;c<a;++c)u.push(s.slice(32768*c,32768*(c+1)));return t.abrupt("return",u);case 11:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}(),n.prototype.dispose=function(){var e=this;this.initialized&&(Object.keys(this.modelVars).forEach(function(t){return e.modelVars[t].dispose()}),this.initialized=!1)},t.DrumGAN=n}(window.tf,window.drumgan),window.neuraldaw=window.neuraldaw||{},function(e,t,n,r){var o=22050,a=16e3,i=256,s={2:0,3:1,4:2,5:3,6:4,7:4,8:4,9:5,10:6,11:7},u=(r.constants.Instruments,r.constants.AllInstruments,new t.GANSynth("https://storage.googleapis.com/magentadata/js/checkpoints/gansynth/acoustic_only")),c=new n.DrumGAN("https://cdn.glitch.com/4437fe19-97b4-4470-a9cf-94e3543ccbac");function l(e,t,n){for(var r=[],o=0;o<e.length;++o){for(var a=e[o],i=n.createBuffer(1,a.length,t),s=i.getChannelData(0),u=0;u<a.length;++u)s[u]=a[u];r.push(i)}return r}function d(){return(d=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("init"),e.next=3,u.initialize();case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function m(e,t){return f.apply(this,arguments)}function f(){return(f=h(regeneratorRuntime.mark(function t(n,r){var o,a,s,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.randomNormal([n,i],0,1,"float32",r),t.next=3,o.data();case 3:for(a=t.sent,o.dispose(),s=[],u=0;u<n;++u)s.push(a.slice(u*i,(u+1)*i));return t.abrupt("return",s);case 8:case"end":return t.stop()}},t)}))).apply(this,arguments)}function p(){return(p=h(regeneratorRuntime.mark(function e(t,n,r,o){var i,s,c,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u.isInitialized()){e.next=2;break}throw"Call initTone first";case 2:if(t.length,void 0!==r){e.next=7;break}return e.next=6,m(1,o);case 6:r=e.sent;case 7:i=u.oneTimbreMultiplePitches(r[0],t),s=[],c=0;case 10:if(!(c<t.length)){e.next=19;break}return e.t0=s,e.next=14,u.specgramsToAudio(i,c);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++c,e.next=10;break;case 19:return i.dispose(),d=l(s,a,n),e.abrupt("return",d);case 22:case"end":return e.stop()}},e)}))).apply(this,arguments)}function g(){return(g=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.initialize();case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function v(e,t){return w.apply(this,arguments)}function w(){return(w=h(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.sampleLatentVector(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function y(e,t,n,r){return b.apply(this,arguments)}function b(){return(b=h(regeneratorRuntime.mark(function e(t,n,r,a){var i,u,d,m,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(i=t.length,u=[],d=0;d<i;++d)u.push(s[t[d]]);if(void 0!==r){e.next=7;break}return e.next=6,v(i,a);case 6:r=e.sent;case 7:return e.next=9,c.generate(u,r);case 9:return m=e.sent,f=l(m,o,n),e.abrupt("return",f);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function S(){return(S=h(regeneratorRuntime.mark(function e(t,n,o){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(r.constants.DrumInstruments,t,n,o);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}r.timbre={},r.timbre.initTone=function(){return d.apply(this,arguments)},r.timbre.generateToneLatentVectors=m,r.timbre.generateTones=function(e,t,n,r){return p.apply(this,arguments)},r.timbre.initDrum=function(){return g.apply(this,arguments)},r.timbre.generateDrumLatentVectors=v,r.timbre.generateDrums=y,r.timbre.generateDrumKit=function(e,t,n){return S.apply(this,arguments)}}(window.tf,window.mm,window.drumgan,window.neuraldaw);n(83);function g(e,t,n,r,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function v(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){g(a,r,o,i,s,"next",e)}function s(e){g(a,r,o,i,s,"throw",e)}i(void 0)})}}function w(e,t,n,r,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function y(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){w(a,r,o,i,s,"next",e)}function s(e){w(a,r,o,i,s,"throw",e)}i(void 0)})}}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}window.neuraldaw=window.neuraldaw||{},function(e,t){var n=t.constants.Instruments,r=t.constants.AllInstruments,o=new e.MusicVAE("https://storage.googleapis.com/magentadata/js/checkpoints/music_vae/trio_4bar");new e.MusicVAE("https://storage.googleapis.com/magentadata/js/checkpoints/music_vae/groovae_unquantize_4bar");function a(){return(a=v(regeneratorRuntime.mark(function e(t,n,r,a){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.sample(1,t,void 0,n,r);case 2:return i=e.sent[0],e.abrupt("return",i);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function i(){return(i=v(regeneratorRuntime.mark(function e(a,i,s,u,c){var l,d,m,f,p,h,g,v,w,y,b;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==i.length){e.next=2;break}return e.abrupt("return",a);case 2:return e.next=4,o.encode([a]);case 4:return l=e.sent,e.next=7,o.decode(l,s,void 0,u,c);case 7:for(d=e.sent[0],l.dispose(),m=a.notes,f=d.notes,p=[],h=0;h<r.length;++h)for(g=r[h],v=i.indexOf(g)>=0,w=v?f:m,y=0;y<w.length;++y)b=w[y],g===n.MLDY&&0===b.instrument?p.push(b):g===n.BASS&&1===b.instrument?p.push(b):2===b.instrument&&g===t.constants.MidiPitchToDrumInstrument[b.pitch]&&p.push(b);return d.notes=p,e.abrupt("return",d);case 15:case"end":return e.stop()}},e)}))).apply(this,arguments)}t.score={},t.score.generateTrio=function(e,t,n,r){return a.apply(this,arguments)},t.score.updateTrioInstruments=function(e,t,n,r,o){return i.apply(this,arguments)}}(window.mm,window.neuraldaw);var S=window.mm,R=window.neuraldaw,x=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.constants={},this.timbre=window.neuraldaw.timbre,this.mm={},this.score={},this.initConstants(),this.initSounds()}var t,n,r;return t=e,(n=[{key:"initConstants",value:function(){var e={MLDY:0,BASS:1,KICK:2,SNAR:3,CHAT:4,OHAT:5,LTOM:6,MTOM:7,HTOM:8,CRSH:9,RIDE:10},t=[e.MLDY,e.BASS],n=[e.KICK,e.SNAR,e.CHAT,e.OHAT,e.LTOM,e.MTOM,e.HTOM,e.CRSH,e.RIDE],r=[e.MLDY,e.BASS,e.KICK,e.SNAR,e.CHAT,e.OHAT,e.LTOM,e.MTOM,e.HTOM,e.CRSH,e.RIDE],o={36:e.KICK,38:e.SNAR,42:e.CHAT,46:e.OHAT,45:e.LTOM,48:e.MTOM,50:e.HTOM,49:e.CRSH,51:e.RIDE};this.constants={Instruments:e,ToneInstruments:t,DrumInstruments:n,AllInstruments:r,MidiPitchToDrumInstrument:o}}},{key:"initSounds",value:function(){var e=this,t=S.Player.tone,n=this.constants,r=n.Instruments,o=n.DrumInstruments,a=new t.Freeverb(.75);a.wet.value=0,a.connect(t.Master);var i=[24,36,48,60,72,84],s=new t.Sampler;s.volume.value=-12,s.connect(a);var u=[24,36,48,60,72,84],c=new t.Sampler;c.volume.value=-12,c.toMaster();var l=new t.Freeverb(.1);l.wet.value=0,l.toMaster();for(var d=[r.CHAT,r.OHAT,r.CRSH,r.RIDE],m={},f=0;f<o.length;++f){var p=o[f];m[p]=new t.Sampler,d.indexOf(p)>=0?(m[p].volume.value=-12,m[p].connect(l)):(m[p].volume.value=-12,m[p].toMaster())}var h=function(){var n=y(regeneratorRuntime.mark(function n(r,o){var a,l,d,m,f;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(a=e.constants.Instruments,o!==a.MLDY){n.next=6;break}l=i,d=s,n.next=12;break;case 6:if(o!==a.BASS){n.next=11;break}l=u,d=c,n.next=12;break;case 11:throw"Invalid instrument ID";case 12:return n.next=14,R.timbre.generateTones(l,r);case 14:for(m=n.sent,f=0;f<l.length;++f)d.add(t.Midi(l[f]).toNote(),m[f]);case 16:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}(),g=function(){var e=y(regeneratorRuntime.mark(function e(n){var r,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.timbre.generateDrumKit(n);case 2:for(r=e.sent,a=0;a<o.length;++a)i=o[a],m[i].add(t.Midi(60).toNote(),r[a]);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=y(regeneratorRuntime.mark(function e(n,r){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.timbre.generateDrums([r],n);case 2:o=e.sent,m[r].add(t.Midi(60).toNote(),o[0]);case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}();this.sounds={drumKit:m,toneMldy:s,toneBass:c,replaceTone:h,replaceDrumKit:g,replaceDrum:v,stopAll:function(){s.releaseAll(),c.releaseAll();for(var e=0;e<o.length;++e){var t=o[e];m[t].releaseAll()}},setReverb:function(e){a.wet.value=e,l.wet.value=e}}}},{key:"playNote",value:function(e,t,n,r){var o=S.Player.tone,a=this.sounds,i=a.toneMldy,s=a.toneBass,u=a.drumKit;e===this.constants.Instruments.MLDY?i.triggerAttackRelease(o.Midi(t.pitch).toNote(),n,r):e===this.constants.Instruments.BASS?s.triggerAttackRelease(o.Midi(t.pitch).toNote(),n,r):u[e].triggerAttackRelease(o.Midi(60).toNote(),n,r)}}])&&b(t.prototype,n),r&&b(t,r),e}();function I(e,t,n,r,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function k(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){I(a,r,o,i,s,"next",e)}function s(e){I(a,r,o,i,s,"throw",e)}i(void 0)})}}window.neuraldaw=window.neuraldaw||{};var T=window.neuraldaw,M=new x,A=new d("canvas-1"),E=new d("canvas-2"),B=new c("canvas-3",M),D=window.mm.Player.tone,C=D.context,O=M.constants,N=O.Instruments,_=O.DrumInstruments,P=!0,H={},L={},V={},K=0,z=0,j=0,G=0,Y=[!1,!1,!1],q=function(){document.getElementById("play").firstChild.textContent="stop",H.start()},U=function(){document.getElementById("play").firstChild.textContent="play",H.stop(),M.sounds.stopAll()},F=function(){D.Transport.start()},J=function(){M.sounds.stopAll(),D.Transport.pause()},W=function(e){D.Transport.bpm.value=e,G=j*(z=60/e/4)},Q=function(){var e=k(regeneratorRuntime.mark(function e(t){var n,r,o,a,i,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:for(L=e.sent,n=L.notes,V={},r=0;r<n.length;++r)o=n[r],(a=o.quantizedStartStep%64)in V||(V[a]=[]),V[a].push(o);i=n.filter(function(e){return 0===e.instrument}),s=n.filter(function(e){return 1===e.instrument}),u=n.filter(function(e){return e.isDrum}),A.updateMelody(i),E.updateMelody(s),B.updateNotes(u);case 12:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=k(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([T.timbre.initTone(),T.timbre.initDrum()]);case 2:return console.log("(0/2)...loading score and timbres"),e.next=5,Promise.all([M.sounds.replaceTone(C,N.MLDY),M.sounds.replaceTone(C,N.BASS),M.sounds.replaceDrumKit(C),Q(T.score.generateTrio())]);case 5:console.log("(1/2)...loaded score and timbres"),W(120),D.Master.volume.value=20*Math.log(.8),H=new D.Sequence(function(e,t){var n=[];(K=t)in V&&(n=V[K]),t%2==1&&(e+=G);for(var r=0;r<n.length;++r){var o=n[r],a=o.quantizedEndStep-o.quantizedStartStep;if(!(a<=0)){var i=a*z,s=void 0;0===o.instrument?s=N.MLDY:1===o.instrument?s=N.BASS:2===o.instrument&&(s=M.constants.MidiPitchToDrumInstrument[o.pitch]),Y[o.instrument]||M.playNote(s,o,i,e)}}},Array.from(Array(64).keys()),"16n"),D.Transport.start(),console.log("(2/2)...the sequencer starts."),document.getElementById("play").firstChild.textContent="stop",P=!1,B.hoveringNotes=Array(9).fill(!1),A.hoveringNotes=!1,E.hoveringNotes=!1,H.start();case 18:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();o()(C,"#play",function(){var e=document.getElementById("play");console.log("AudioContext started!"),console.log("start loading..."),e.firstChild.textContent="loading",console.log("%c Neural Loops ","background: #222; color: #f70ec4; font-size: 20px;"),console.log("%c 2019-04-24 ","background: #fff; color: #f70ec4; font-size: 15px;"),console.log("%c made by Vibert and Chris.","background: #fff; color: #f70ec4; font-size: 15px;"),X(),function(){document.getElementById("play").onclick=function(){P||("started"===H.state?U():q())},document.getElementById("reload").onclick=k(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return U(),console.log("(0/1)...loading score and timbres"),B.waiting=!0,A.waiting=!0,E.waiting=!0,e.next=7,Promise.all([M.sounds.replaceTone(C,N.MLDY),M.sounds.replaceTone(C,N.BASS),M.sounds.replaceDrumKit(C),Q(T.score.generateTrio())]);case 7:console.log("(1/1)...loaded score and timbres"),B.waiting=!1,A.waiting=!1,E.waiting=!1,q();case 12:case"end":return e.stop()}},e)})),document.getElementById("reload").onmouseenter=function(){A.hoveringSounds=!0,E.hoveringSounds=!0,B.hoveringSounds=Array(9).fill(!0)},document.getElementById("reload").onmouseleave=function(){A.hoveringSounds=!1,E.hoveringSounds=!1,B.hoveringSounds=Array(9).fill(!1)},document.getElementById("update-sco-all").onclick=k(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return U(),console.log("(0/1)...loading score and timbres"),B.waiting=!0,A.waiting=!0,E.waiting=!0,e.next=7,Promise.all([Q(T.score.generateTrio())]);case 7:console.log("(1/1)...loaded score and timbres"),B.waiting=!1,A.waiting=!1,E.waiting=!1,q();case 12:case"end":return e.stop()}},e)})),document.getElementById("update-sco-all").onmouseenter=function(){A.hoveringNotes=!0,E.hoveringNotes=!0,B.hoveringNotes=Array(9).fill(!0)},document.getElementById("update-sco-all").onmouseleave=function(){A.hoveringNotes=!1,E.hoveringNotes=!1,B.hoveringNotes=Array(9).fill(!1)},document.getElementById("update-tim-melody-bass").onclick=k(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return U(),console.log("(0/1)...loading score and timbres"),A.waiting=!0,E.waiting=!0,e.next=6,Promise.all([M.sounds.replaceTone(C,N.MLDY),M.sounds.replaceTone(C,N.BASS)]);case 6:console.log("(1/1)...loaded score and timbres"),A.waiting=!1,E.waiting=!1,q();case 10:case"end":return e.stop()}},e)})),document.getElementById("update-tim-melody-bass").onmouseenter=function(){A.hoveringSounds=!0,E.hoveringSounds=!0},document.getElementById("update-tim-melody-bass").onmouseleave=function(){A.hoveringSounds=!1,E.hoveringSounds=!1},document.getElementById("update-tim-drums").onclick=k(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return U(),console.log("(0/1)...loading score and timbres"),B.waiting=!0,e.next=5,Promise.all([M.sounds.replaceDrumKit(C)]);case 5:console.log("(1/1)...loaded score and timbres"),B.waiting=!1,q();case 8:case"end":return e.stop()}},e)})),document.getElementById("update-tim-drums").onmouseenter=function(){B.hoveringSounds=Array(9).fill(!0)},document.getElementById("update-tim-drums").onmouseleave=function(){B.hoveringSounds=Array(9).fill(!1)},document.getElementById("volume").onchange=function(e){var t=20*Math.log(.01*e.target.value);D.Master.volume.value=t},document.getElementById("bpm").onchange=function(e){W(e.target.value)},document.getElementById("swing").onchange=function(e){j=e.target.value/e.target.max*.5,G=j*z},document.getElementById("reverb").onchange=function(e){var t=e.target.value/e.target.max;M.sounds.setReverb(t)},document.getElementById("update-sco-tm").onclick=k(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return J(),A.waiting=!0,e.next=4,Q(T.score.updateTrioInstruments(L,[N.MLDY],.4));case 4:F(),A.waiting=!1;case 6:case"end":return e.stop()}},e)})),document.getElementById("update-sco-tm").onmouseenter=function(){A.hoveringNotes=!0},document.getElementById("update-sco-tm").onmouseleave=function(){A.hoveringNotes=!1},document.getElementById("update-tim-tm").onclick=k(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return J(),A.waiting=!0,e.next=4,M.sounds.replaceTone(C,N.MLDY);case 4:F(),A.waiting=!1;case 6:case"end":return e.stop()}},e)})),document.getElementById("update-tim-tm").onmouseenter=function(){A.hoveringSounds=!0},document.getElementById("update-tim-tm").onmouseleave=function(){A.hoveringSounds=!1},document.getElementById("update-sco-tb").onclick=k(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return J(),E.waiting=!0,e.next=4,T.score.updateTrioInstruments(L,[N.BASS],.4);case 4:F(),E.waiting=!1;case 6:case"end":return e.stop()}},e)})),document.getElementById("update-sco-tb").onmouseenter=function(){E.hoveringNotes=!0},document.getElementById("update-sco-tb").onmouseleave=function(){E.hoveringNotes=!1},document.getElementById("update-tim-tb").onclick=k(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return J(),E.waiting=!0,e.next=4,M.sounds.replaceTone(C,N.BASS);case 4:F(),E.waiting=!1;case 6:case"end":return e.stop()}},e)})),document.getElementById("update-tim-tb").onmouseenter=function(){E.hoveringSounds=!0},document.getElementById("update-tim-tb").onmouseleave=function(){E.hoveringSounds=!1};for(var e=function(e){document.getElementById("update-sco-d"+String(e)).onclick=k(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return J(),B.waiting=!0,t.next=4,Q(T.score.updateTrioInstruments(L,[_[e]],.4));case 4:F(),B.waiting=!1;case 6:case"end":return t.stop()}},t)})),document.getElementById("update-sco-d"+String(e)).onmouseenter=function(){B.hoveringNotes[8-e]=!0},document.getElementById("update-sco-d"+String(e)).onmouseleave=function(){B.hoveringNotes[8-e]=!1}},t=0;t<_.length;++t)e(t);var n=function(e){document.getElementById("update-tim-d"+String(e)).onclick=k(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return J(),B.waiting=!0,t.next=4,M.sounds.replaceDrum(C,_[e]);case 4:F(),B.waiting=!1;case 6:case"end":return t.stop()}},t)})),document.getElementById("update-tim-d"+String(e)).onmouseenter=function(){B.hoveringSounds[8-e]=!0},document.getElementById("update-tim-d"+String(e)).onmouseleave=function(){B.hoveringSounds[8-e]=!1}};for(t=0;t<_.length;++t)n(t);[document.getElementById("mute-melody"),document.getElementById("mute-bass"),document.getElementById("mute-drum")].forEach(function(e,t){e.addEventListener("click",function(){Y[t]?e.firstChild.textContent="🔈":e.firstChild.textContent="🔇",Y[t]=!Y[t]})})}(),requestAnimationFrame(function(){!function e(){A.draw(K),E.draw(K),B.draw(K),requestAnimationFrame(function(){e()})}()})})}});
//# sourceMappingURL=app.a3eb9351.js.map